// Test Bootstrap Compilation
// Verifies that bootstrap compilers work correctly

fn test_file_operations() -> bool {
    print("Test 1: File Operations\n");
    
    // Test file write
    let out = file_open("test_file.txt");
    let write_ok = file_write(out, "Bootstrap test");
    file_close(out);
    
    if write_ok {
        print("  ✓ File write successful\n");
    } else {
        print("  ✗ File write failed\n");
        return false;
    }
    
    // Test file read
    let in_handle = file_open("test_file.txt");
    let content = file_read_line(in_handle);
    file_close(in_handle);
    
    if string_len(content) > 0 {
        print("  ✓ File read successful\n");
        return true;
    } else {
        print("  ✗ File read failed\n");
        return false;
    }
}

fn test_string_operations() -> bool {
    print("Test 2: String Operations\n");
    
    let test_str = "Hello Bootstrap";
    let len = string_len(test_str);
    
    if len == 15 {
        print("  ✓ String length correct\n");
    } else {
        print("  ✗ String length incorrect\n");
        return false;
    }
    
    let first_char = string_char_at(test_str, 0);
    if first_char == 72 { // 'H'
        print("  ✓ Character access works\n");
        return true;
    } else {
        print("  ✗ Character access failed\n");
        return false;
    }
}

fn test_code_generation() -> bool {
    print("Test 3: Code Generation\n");
    
    let out = file_open("test_gen.c");
    file_write(out, "#include <stdio.h>\n");
    file_write(out, "int main() { return 0; }\n");
    file_close(out);
    
    print("  ✓ C code generated\n");
    return true;
}

fn main() {
    print("=== Bootstrap Compilation Tests ===\n\n");
    
    let mut tests_passed = 0;
    let total_tests = 3;
    
    if test_file_operations() {
        tests_passed = tests_passed + 1;
    }
    print("\n");
    
    if test_string_operations() {
        tests_passed = tests_passed + 1;
    }
    print("\n");
    
    if test_code_generation() {
        tests_passed = tests_passed + 1;
    }
    print("\n");
    
    print("Results: ");
    print_int(tests_passed);
    print(" / ");
    print_int(total_tests);
    print(" tests passed\n\n");
    
    if tests_passed == total_tests {
        print("🎉 All tests passed! Bootstrap is working!\n");
    } else {
        print("❌ Some tests failed\n");
    }
}